# Speedtest Flink App

This application reads speedtest records from Kinesis and writes them to Timestream.

## Design

Upon launch of the `com.elphastori.faster.speedtest.StreamingJob#main` function, _TimestreamInitializer_ creates target Timestream database/table if they do not exist.

Next, Flink Streaming environment is created, which processes the records from Kinesis Stream specified by _InputStreamName_.

Kinesis Stream contains records generated by the [python speedtest runner](../runner). The _model_ directory contains:
* **Speedtest**: a JSON serializable class to represent a **speedtest record**
* **TimestreamRecordConverter**: converts JSON classes to Timestream Records
* **TimestreamRecordDeserializer**: deserializes bytes to Timestream Record using a **TimestreamRecordConverter**

Check `com.elpahstori.faster.speedtest.StreamingJob#main` for configuration details.

For configuration settings related to Timestream sink, please check [flink-connector-timestream](https://github.com/awslabs/amazon-timestream-tools/tree/mainline/integrations/flink_connector/flink-connector-timestream).

## Running the app locally

To compile and package this application, run:
```
mvn clean compile && mvn package
```

You can run the application on your local environment by running `StreamingJobs` class:
```
mvn install exec:java -Dexec.mainClass="com.elphastori.faster.speedtest.StreamingJob" -Dexec.args="--InputStreamName SpeedtestStream --Region us-east-1 --TimestreamDbName kdaflink --TimestreamTableName kinesisdata" -Dexec.classpathScope=test
```
